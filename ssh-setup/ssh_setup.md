# WSL SSH Setup

I remember this being a pain when I tried doing this on a previous machine so I'm documenting the steps exactly I took to setup SSH with WSL here. This will also hopefully make it easy to debug things if issues come up 

## Background
Found the file [github_ssh_setup.md](https://gist.github.com/JARVIS-AI/a20f38c88bee6b0d2fd5938b94bac438) on github when trying to search for info on how to setup ssh keys

then looked around a bit more for info on some of the commands because info was a bit sparse in the file
found the info in keychain_info.md from an [article](https://pscheit.medium.com/use-an-ssh-agent-in-wsl-with-your-ssh-setup-in-windows-10-41756755993e
). I added these under a folder called resources which I've added to `.gitignore` so that I'm not republishing their work.

## Pre-setup in wsl

I'm going add something to my wsl options (wsl.conf) which lives under `/etc/wsl.conf`
created `/etc/wsl.conf` with `sudo vim /etc/wsl.conf` with the contents

```
[automount]
enabled = true
options = "metadata,umask=22,fmask=11"
```
To make sure permissions are sane when sharing files between the filesystems .

## Generate ssh keys on windows and move them to wsl

Install git for windows which will likely create an ssh key on windows under 
`/home/USERNAME/.ssh`

Nope, had to manually do this but it was pretty easy to run `ssh-keygen -t rsa` under a new hidden windows folder `C:\Users\tim\.ssh` I created. Then I moved the generated files to my wsl directory by first going to the folder

```cd /mnt/c/Users/tim/.ssh```

and then running

```cp id_rsa* ~/.ssh```

easy!

now I checked perms on the files we copied with `stat --format '%a' <file>` they were both 744, this is not what we want for the .ssh files they need to be 600 so we chmod the private key with `chmod 600 $HOME/.ssh/id_rsa`

which fixed permissions.


## Setup wsl ssh-agent with keychain package

Tried to add the ssh-keys to my ssh-agent but it was unable to do so `Could not open a connection to your authentication agent.` Likely there is no ssh-agent running currently. I think installing keychain as described in the other guide will fix this

Tried to install keychain
```sudo apt-get install keychain```

and got response
```Package 'keychain' has no installation candidate```

Think this is because the package list has not been added to the system yet so I ran

```sudo apt-get update```


and then tried again

```sudo apt-get install keychain```

this installed keychain

then I read up on whether I should run ```sudo apt-get upgrade``` and decided to run it to upgrade the system. Not sure if this was the best idea to do it after but that's what I did.

## Setup .vimrc

I don't like to add too many fancy things to vim. I'm not a vim poweruser though.

``` vim
" set to a colorscheme that doesnt primarly use a hard to read dark-blue on my black shell background
colo desert
" show line numbers (can be disabled with set nonumber)
set number
" show command being typed
set showcmd
```

Now following the keychain_info.md tutorial I'm adding these lines to my ~/.bashrc file


```/usr/bin/keychain --nogui $HOME/.ssh/id_rsa```

```source $HOME/.keychain/$HOSTNAME-sh```

which starts the ssh-agent and keychain program if not running? (first-line), and adds the relevant env variables using the script generated by keychain which resides at the location we are sourcing in the second line

restarted wsl and can now see that ssh-agent is running in the background with `ps ax` (or `ps ax | grep ssh-agent` if we eventually install a bunch of programs )

`2784 ?        Ss     0:00 ssh-agent`

We also were asked for the ssh-key password on startup which it accepted.

Decided to add this repo to github using vscode's built in git helper. Forgot about to setting up git's username/email defaults did this by running these commands in "git bash" ...

## Git config and github setup

``` bash
git config --global user.name "Tim Travitz"
git config --global user.email "tim@travitz.net"
```

which created a gitconfig in `/c/Users/tim` aka `C:\Users\tim\.ssh`

Probably need to do this in wsl separately as well...

``` bash
cd
git config --global user.name "Tim Travitz"
git config --global user.email "tim@travitz.net"
```

The above creates a `.gitconfig` file under `~/.gitconfig`


Finally I add the id_rsa.pub (the ssh public key) to github which will allow me to push to github as my github user.

Login on github, click on user icon, go to settings > ssh and gpg keys > New SSH key 

Give key I'm adding an arbitrary name, "Tim's New Computer Key". Select authentication key and paste the contents of the id_rsa.pub we generated earlier into the Key field.

Everything seems to have been setup.